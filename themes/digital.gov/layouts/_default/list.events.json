{{ $now := now }}
{{ $events := where .Site.Pages "Section" "events" }}
{{ $events := (where $events ".Params.date" "ge" (now.AddDate 0 0 -1)).ByDate }}
{{ $list := $events -}}
{{ $length := (len $list) -}}
{
    "version" : "https://jsonfeed.org/version/1",
    "title" : "{{ if eq  .Title  .Site.Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{.}} on {{ end }}{{ .Site.Title }}{{ end }}",
    "description": "Recent content {{ if ne  .Title  .Site.Title }}{{ with .Title }}in {{.}} {{ end }}{{ end }}on {{ .Site.Title }}",
    "home_page_url" : "{{ .Site.BaseURL }}",
    "github_org" : "GSA",
    "github_repo" : "http://github.com/GSA/digitalgov.gov",
    {{ with .OutputFormats.Get "JSON" -}}
    "feed_url" : "{{ .Permalink }}",
    {{ end -}}
    {{ with $.Param "icon" -}}
    "icon" : "{{ . | absURL }}",
    {{ end -}}
    {{ with $.Param "favicon" -}}
    "favicon" : "{{ $.Param "favicon" }}",
    {{ end -}}
    {{ with .Site.Author.name -}}
    "author" : {
        "name" : "{{ . }}"{{ with $.Site.Author.url }},
        "url": "{{ . }}"{{ end }}{{ with $.Site.Author.avatar }},
        "avatar": "{{ . | absURL }}"{{ end }}
    },
    {{ end -}}
    "items" : [
    {{ range $index, $element := $list -}}
    {
        "slug" : "{{ .Params.slug }}",
        "url" : "{{ .Permalink }}",
        {{ if .Params.summary -}}
        "summary" : {{ .Params.summary | jsonify }},
        {{ end -}}
        "title" : {{ .Title | jsonify }},
        "date_modified" : "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ with .Params.author -}}
        "author" : {
          "name" : "{{ . }}"
        },
        {{ end -}}
        "start_date" : "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        "end_date" : "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ if (not (isset .Params "event_type")) | or (eq .Params.event_type "") }}
        {{ else }}
          {{ $_eventtype := .Params.event_type }}
          {{ $length := $_eventtype | len }}
          "event_type" : [
            {
              {{ range $i, $e := .Params.event_type }}
                {{ $etype := index $.Site.Data.events $e }}
                {{ if lt (add $i 1) $length }}
                "{{ $e }}" : "{{ $etype.name | default $e }}",
                {{ else }}
                "{{ $e }}" : "{{ $etype.name | default $e }}"
                {{ end }}
              {{ end }}
            }
          ],
        {{ end }}
        "youtube_id" : "{{ .Params.youtube_id }}",
        "registration_url" : "{{ .Params.registration_url }}",
          {{ if (isset .Params "venue") }}
          "event_location" : [
            {
              "name" : "{{ .Params.venue.venue_name }}",
              "address" : "{{ .Params.venue.address }}",
              "city" : "{{ .Params.venue.city }}",
              "zip" : "{{ with .Params.venue.zip }}",
              "room" : "{{ with .Params.venue.room }}",
              "map" : "{{ .Params.venue.map }}",
            }
          ],
          {{ end -}}
        {{ end -}}
        {{ end -}}

        "file_path" : "{{.File.Path}}",
        {{ if .GitInfo }}
        "gitinfo" : [
          {
            "lastModified" : "{{ .GitInfo.AuthorDate }} ",
            "subject" : "{{ .GitInfo.Subject }} ",
            "editorName" : "{{ .GitInfo.AuthorName }} ",
            "editorEmail" : "{{ .GitInfo.AuthorEmail }} ",
            "abbreviatedHash" : "{{ .GitInfo.AbbreviatedHash }} ",
            "hash" : "{{ .GitInfo.Hash }} "
          }
        ],
        {{ end -}}
        "content_html" : {{ .Content | jsonify }}

    }{{ if ne (add $index 1) $length }},{{ end }}
    {{ end -}}
    ]
}
